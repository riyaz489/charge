option_settings:
  "aws:elasticbeanstalk:application:environment":
    DJANGO_SETTINGS_MODULE: "india_hackathon.settings"
    "PYTHONPATH": "/opt/python/current/app:$PYTHONPATH"
  "aws:elasticbeanstalk:container:python":
    WSGIPath: "india_hackathon/wsgi.py"




container_commands:
  01_migrate:
    command: "source /opt/python/run/venv/bin/activate && cd /opt/python/current/app && python ./manage.py migrate --noinput"
    leader_only: true

  02_elatic_search_indexing:
    command: "python ./manage.py search_index --rebuild -f"
    leader_only: true

packages:
  yum:
     git: []
     mysql-server: []
     mysql: []

commands:
  command block:
    command: |
      sudo su
      yum install java-1.8.0-openjdk-devel -y
      yum install -y
      wget  https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.2.noarch.rpm
      yum install elasticsearch-1.7.2.noarch.rpm -y
      rm -f elasticsearch-1.7.2.noarch.rpm
      service elasticsearch start
      sudo chkconfig --add elasticsearch
    cwd: /home/ec2-user



files:
  "/etc/elasticsearch/elasticsearch.yml":
    mode: "000755"
    owner: root
    group: root
    content: |
      ################## elastic search #########################
      # ----------------------------------- Paths ------------------------------------
      #
      # Path to directory where to store the data (separate multiple locations by comma):
      #
      path.data: /var/lib/elasticsearch
      #
      # Path to log files:
      #
      path.logs: /var/log/elasticsearch
      #
      # ----------------------------------- Memory -----------------------------------
      #
      # Lock the memory on startup:
      #
      #bootstrap.memory_lock: true
      #
      # Make sure that the heap size is set to about half the memory available
      # on the system and that the owner of the process is allowed to use this
      # limit.
      #
      # Elasticsearch performs poorly when the system is swapping the memory.
      #
      # ---------------------------------- Network -----------------------------------
      #
      # Set the bind address to a specific IP (IPv4 or IPv6):
      #
      network.host: localhost
      #
      # Set a custom port for HTTP:
      #
      http.port: 9200